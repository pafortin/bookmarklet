javascript:(function(){const s=t=>new Promise(e=>setTimeout(e,t)),l=(...t)=>console.log("[MEETUP]",...t);(()=>{const t=[/sentry\.io/i,/ingest\./i,/analytics/i],e=window.fetch;e&&(window.fetch=async(...n)=>{try{if(t.some(t=>t.test(String(n[0]?.url||n[0]||""))))return new Response(null,{status:204})}catch{}return e(...n)})})();async function fetchRetry(t,e,n=5){for(let a=0;a<=n;a++)try{const n=await fetch(t,e);if(429===n.status){const t=1e3*Math.min(parseInt(n.headers.get("Retry-After")||"2",10),1e4);await s(t);continue}if(!n.ok&&a<n){await s(1e3*Math.pow(2,a));continue}return n}catch(t){if(a===n)throw t;await s(1e3*Math.pow(2,a))}}function makeUI(){const t=document.getElementById("meetupScraperUI");t&&t.remove();const e=document.createElement("div");e.id="meetupScraperUI",e.style.cssText="position:fixed;top:20px;right:20px;z-index:2147483647;background:#1a1a1a;color:#fff;padding:16px;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.5);font:13px/1.4 -apple-system,sans-serif;min-width:340px;max-width:440px";const n=document.createElement("div");n.style.cssText="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px";const a=document.createElement("div");a.textContent="üéØ Meetup Scraper",a.style.cssText="font-weight:600;font-size:15px";const r=document.createElement("button");r.textContent="‚úï",r.style.cssText="background:#333;border:none;color:#aaa;width:28px;height:28px;border-radius:6px;cursor:pointer;font-size:16px",r.onclick=()=>e.remove(),n.append(a,r);const c=document.createElement("div");c.id="scraperStage",c.style.cssText="margin:8px 0;color:#ddd;font-size:13px";const o=document.createElement("div");o.style.cssText="height:8px;background:#333;border-radius:4px;overflow:hidden;margin:10px 0";const i=document.createElement("div");i.id="scraperBar",i.style.cssText="height:100%;width:0%;background:linear-gradient(90deg,#3b82f6,#8b5cf6);transition:width .3s ease",o.append(i);const d=document.createElement("div");d.id="scraperDetails",d.style.cssText="margin-top:8px;color:#999;font-size:12px;min-height:18px";const u=document.createElement("button");u.textContent="‚è∏%EF%B8%8F Pause",u.id="pauseBtn",u.style.cssText="margin-top:10px;width:100%;background:#333;color:#fff;border:none;padding:8px;border-radius:6px;cursor:pointer;font-size:12px",u.onclick=()=>{window.pauseScroll=!window.pauseScroll,u.textContent=window.pauseScroll?"‚ñ∂%EF%B8%8F Resume":"‚è∏%EF%B8%8F Pause"},e.append(n,c,o,d,u),document.body.appendChild(e)}function updateUI(t,e,n=""){const a=document.getElementById("scraperStage"),r=document.getElementById("scraperBar"),c=document.getElementById("scraperDetails");a&&(a.textContent=t),r&&(r.style.width=%60${Math.min(100,Math.max(0,e))}%%60),c&&(c.textContent=n)}function getGroupUrlname(){const t=window.location.pathname.match(/^\/([^\/]+)\/(?:fr-FR\/)?([^\/]+)\//);if(t)return"fr-FR"===t[1]||"en-US"===t[1]?t[2]:t[1];const e=window.location.pathname.split("/").filter(Boolean);return e[0]||null}function extractEventIds(t){const e=new Set;l(%60üîç Extracting for group: ${t}%60);const n=new RegExp(%60/${t}/events/(\\d+)%60);return document.querySelectorAll('a[href*="/events/"]').forEach(t=>{const a=(t.getAttribute("href")||"").match(n);a&&a[1]&&e.add(a[1])}),[...e]}async function fetchEventPage(t,e=null){const n={eventId:t,filter:{rsvpStatus:["YES","ATTENDED"]},sort:{sortField:"RSVP_ID",sortOrder:"ASC"},first:100};e&&(n.after=e);const a={operationName:"getEventByIdForAttendees",variables:n,extensions:{persistedQuery:{version:1,sha256Hash:"06e14c0b9938b3f0cbd5f0ef3a4cf910d01285c8bcc6ebf76b0f0aafbf19b076"}}},r=await fetchRetry("https://www.meetup.com/gql2",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify(a)});return r&&r.ok?await r.json():null}async function fetchAttendees(t,e,n){const a=[];let r=null;for(updateUI("Fetching Attendees...",35+Math.round(e/n*60),%60Processing Event ${e+1}/${n} (ID: ${t})%60);r!==void 0;){const e=await fetchEventPage(t,r);if(!e?.data?.event)break;const n=e.data.event;(n.rsvps?.edges||[]).forEach(e=>{const n=e.node||{},r=n.member||{},c=n.membership||{};a.push({eventId:t,memberName:r.name||"Unknown",memberId:r.id||"",status:n.status||"",guests:n.guestsCount||0,eventsAttended:r.eventsAttended||0,noShowCount:r.noShowCount||0,memberRole:c.role||"MEMBER",memberStatus:c.status||"ACTIVE",isFamiliarFace:r.isFamiliarFace?1:0})});const c=n.rsvps?.pageInfo?.hasNextPage;r=c?n.rsvps.pageInfo.endCursor:void 0,await s(50)}return l(%60‚úÖ Event ${t}: ${a.length} attendees%60),updateUI("Fetching Attendees...",35+Math.round((e+1)/n*60),%60‚úÖ Event ${e+1}/${n} (ID: ${t}) fetched: ${a.length} attendees.%60),a}(async()=>{try{makeUI(),updateUI("Init...",0);const t=getGroupUrlname();if(!t)return updateUI("‚ùå Group not found",100,"Check the URL"),void l("‚ùå No group");l(%60üìç Group: ${t}%60),updateUI(%60Group: ${t}%60,5),await s(1e3),updateUI("Extracting Event IDs...",32,"Please scroll the page manually to load all events first.");const e=extractEventIds(t);if(0===e.length)return updateUI("‚ùå 0 events found",100),void l("‚ùå No events");l(%60‚úÖ Extracted ${e.length} unique event IDs%60),updateUI(%60Found ${e.length} Events%60,35,"Starting attendee fetch.");const n=[],a=e.length,r=Math.min(5,a);for(let t=0;t<a;t+=r){const c=e.slice(t,t+r),o=await Promise.all(c.map(async(e,n)=>{try{return await fetchAttendees(e,t+n,a)}catch(r){return l(%60‚ùå ${e}:%60,r.message),updateUI("Fetching Attendees...",35+Math.round((t+n+1)/a*60),%60‚ùå Event ${t+n+1}/${a} (ID: ${e}) failed.%60),[]}}));n.push(...o.flat()),await s(120)}if(updateUI("Generating CSV...",96),0===n.length)return updateUI("‚ö†%EF%B8%8F 0 attendees found",100),void l("‚ö†%EF%B8%8F No attendees");const c=["eventId","memberName","memberId","status","guests","eventsAttended","noShowCount","memberRole","memberStatus","isFamiliarFace"],o=[c.join(",")];n.forEach(t=>{const e=c.map(e=>%60"${String(t[e]||"").replace(/"/g,'""')}"%60);o.push(e.join(","))});const i=o.join("\n"),d=new Blob([i],{type:"text/csv;charset=utf-8"}),u=URL.createObjectURL(d),p=document.createElement("a"),m=new Date().toISOString().slice(0,10);p.href=u,p.download=%60meetup_${t}_enriched_${m}.csv%60,p.click(),URL.revokeObjectURL(u),updateUI("‚úÖ Done!",100,%60${e.length} events | ${n.length} attendees%60),l(%60‚úÖ ${e.length} events, ${n.length} attendees%60);const g=document.getElementById("pauseBtn");g&&(g.textContent="‚úÖ OK",g.disabled=!0,g.style.opacity="0.5")}catch(t){l("‚ùå ERROR:",t),updateUI("‚ùå Error",100,t.message),console.error(t)}})()})();
